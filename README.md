# mftwdfa_code

This repository contains code to run and analyze results from the MFTWDFA (multi-fractal detrended fluctuation analysis) method. This method was developed to extract the fluctuation function and noise behaviors of nonstationary multifractal time series, as described in Moon & Wettlaufer 2012 (https://royalsocietypublishing.org/doi/10.1098/rspa.2011.0728).

## Setting up filesystem and parameters
This code writes and reads MFTWDFA results to/from certain folders in your filesystem. For this to work, you need to create the proper file structure and set the address of those files in `set_params.m`.

#### First: 
Create a folder called `results`. This will hold all the outputs you will ever get from this MFTWDFA code.

#### Second: 
Within `results`, you need to make a subfolder for each data set you will be working with. Pick an official nametag to identify each data set, name the folder as such, and keep track of that name for use in running the code (will be the variable `data_name').

#### Third: 
Customize the information within `set_params` for each dataset you are analyzing. The fields you will need for each dataset are:
* results_folder: set this at the top of the file, to give the address for `results` for all of your datasets
* `data_name`: the official nametag you chose earlier to identify the dataset.
  * this will autogenerate the address of the subfolder, in combination with `results_folder`
* `filepath_in`: full address of the dataset you are analying
* `varnames`: column heading names for the dataset you are reading in as a table
* `read_settings`: cell array with (1) row index at which to start reading data, (2) scale factor for time axis. if empty, (1) and (2) are set to 1
* `bounds_lhs`, `bounds_rhs`: log(t)-axis bounds for the left and right slope sections of the fluctuation function plot



## How to run MFTWDFA and analysis
Use `main_algo.m` to run the full routine. 

To choose which data set to analyze, enter your official dataset tag in the `data_name` variable. Then, `set_params` will retrieve and set all the appropriate file paths and variables.

The program will then set the range of parameters with which to run MFTWDFA - (1) interpolation scheme, (2) resolution, and (3) q-values. (1) & (3) shouldn't ever change, while (2) will adapt to the average resolution of the original dataset.

Then `run_mftwdfa.m` will execute, which runs MFTWDFA over the range of inputted parameters as aforementioned.

Finally, `main_analysis.m` will run, which performs a range of analyses on the MFTWDFA output generated by `run_mftwdfa.m`.


## How MFTWDFA algorithm works
Steps within `mftwdfa.m`, looped over a range of timescales:
* `interpolate.m`: generate an equispaced interpolation of the original dataset
* `prof.m`: calculate cumulative sum profile for the interpolated data set
* `wfit.m`: find a point-by-point weighted fit to the profile, with weighting based on timescale
* `var_sum.m`: divide the profile into timescale-size segments, and calculate the variance around the weighted fit for each segment
* calculate the fluctuation function from the variances
* write to a file the array of timescales and the array of fluctuation function values

Steps within `run_mftwdfa.m`:
* `load_data.m`: reads in raw dataset as a table
* unpack cell array of MFTWDFA setting values
* run MFTWDFA for each combination of setting values


## How analysis works
`main_analysis.m` performs two categories of analysis: (1) slope analysis, (2) fluctuation function comparison, (3) multifractal structure comparison.

#### Slope analysis

#### Fluctuation function comparison

#### Multifractal structure comparison



^^^ finish that stuff later
